<!DOCTYPE html>
<html>
<head>
    <title>爱购</title>
    <style>
       .search-input {
            width: 100%;
            height: 44px;
            padding-left: 44px;
            border: 2px solid #999;
            border-radius: 22px;
            outline: none;
            font-size: 16px;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%23666"><path d="M16.32 14.9l5.39 5.4a1 1 0 0 1-1.42 1.4l-5.38-5.38a8 8 0 1 1 1.41-1.41zM10 16a6 6 0 1 0 0-12 6 6 0 0 0 0 12z"/></svg>') no-repeat 16px center;
            background-size: 20px;
            box-sizing: border-box;
            margin: 10px 0;
        }
       .search-input::placeholder {
            color: #999;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background-color: #fff;
        }
        th,
        td {
            border: 1px solid #ccc;
            padding: 12px 8px;
            text-align: left;
        }
        th {
            background-color: #f8f8f8;
            font-weight: 600;
        }
       .popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
            z-index: 999;
        }
       .quantity-btn {
            padding: 10px 20px;
            font-size: 16px;
            margin: 0 10px;
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
       .close-btn,
       .add-btn {
            padding: 10px 20px;
            margin-top: 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
       .close-btn {
            background: #f4f4f4;
            border: 1px solid #ccc;
            margin-right: 10px;
        }
       .add-btn {
            background: #8b4513;
            color: white;
            border: none;
        }
       .bottom-buttons {
            margin: 20px 0;
            text-align: center;
        }
       .bottom-button {
            padding: 10px 20px;
            margin: 0 10px;
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
       .added-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background-color: #4CAF50;
            color: white;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            display: none;
            z-index: 999;
        }
       .copied-toast {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 999;
        }
       .load-error {
            text-align: center;
            padding: 50px 0;
            color: #ff4444;
            font-size: 16px;
        }
    </style>
    <style>
        /* 基础样式重置 */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            /* 给主体内容添加边距，避免被顶部搜索栏和底部按钮遮挡 */
            margin-top: 60px;  /* 等于搜索栏高度 */
            margin-bottom: 70px;  /* 等于底部按钮区域高度 */
            padding: 20px;
            min-height: 2000px; /* 仅用于测试滚动效果，实际可删除 */
        }
        /* 顶部搜索栏 - 固定在顶部 */
        .search-bar {
            position: fixed;  /* 固定定位，不随滚动移动 */
            top: 0;  /* 距离顶部0 */
            left: 0;
            right: 0;  /* 左右贴边，占满宽度 */
            height: 60px;  /* 固定高度 */
            padding: 0 20px;
            background-color: #fff;  /* 白色背景，避免与内容重叠时透明 */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1); /* 轻微阴影，区分层级 */
            display: flex;
            align-items: center; /* 垂直居中 */
            z-index: 100;  /* 确保在其他内容上方 */
        }
        /* 底部按钮区域 - 固定在底部 */
        .bottom-buttons {
            position: fixed;  /* 固定定位 */
            bottom: 0;  /* 距离底部0 */
            left: 0;
            right: 0;  /* 左右贴边，占满宽度 */
            height: 70px;  /* 固定高度 */
            background-color: #fff;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1); /* 顶部阴影，区分层级 */
            display: flex;
            justify-content: center; /* 水平居中 */
            align-items: center; /* 垂直居中 */
            gap: 20px; /* 按钮之间的间距 */
            padding: 0 20px;
            z-index: 100; /* 确保在其他内容上方 */
        }
        .bottom-button {
            padding: 10px 20px;
            background-color: #8b4513;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.2s;
        }
        .bottom-button:hover {
            background-color: #6d380e;
        }
    </style>
</head>
<body>
    <!-- 顶部固定搜索框（保留唯一搜索框，绑定搜索功能） -->
    <div class="search-bar">
        <input type="search" class="search-input" placeholder="请输入商品名称，未列产品可微信咨询" 
               oninput="filterTable()" onkeydown="handleKeyDown(event)">
    </div>

    <!-- 商品表格 -->
    <table>
        <thead>
            <tr>
                <th>时间</th>
                <th>商品名</th>
                <th>价格</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- 商品行将从products.json动态加载 -->
        </tbody>
    </table>
    
    <!-- 数据加载失败提示（默认隐藏） -->
    <div class="load-error" id="loadError" style="display: none;">
        商品数据加载失败，请检查products.json文件是否存在且格式正确！
    </div>
    <!-- 加购弹窗 -->
    <div class="popup" id="myPopup">
        <div class="popup-content">
            <h2>添加购物清单</h2>
            <p id="popupProductInfo"></p>
            <button class="quantity-btn" onclick="decrementQuantity()">-</button>
            <input type="number" id="quantity" value="1" min="1" style="width: 50px; text-align: center;">
            <button class="quantity-btn" onclick="incrementQuantity()">+</button>
            <br>
            <button class="close-btn" onclick="closePopup()">取消</button>
            <button class="add-btn" onclick="addToCart()">加入清单</button>
        </div>
    </div>
    <!-- 已加购提示 -->
    <div class="added-toast" id="addedToast">已加购</div>
    <!-- 复制微信提示 -->
    <div class="copied-toast" id="copiedToast">微信复制成功</div>
    <!-- 底部固定导航按钮（保留唯一底部按钮区） -->
    <div class="bottom-buttons">
        <button class="bottom-button" onclick="goToHome()">首页</button>
         <button class="bottom-button" onclick="goToSpecial()">特价/新品</button>
        <button class="bottom-button" onclick="goToCart()">购物清单</button>
        <button class="bottom-button" onclick="copyWechat()">复制微信</button>
    </div>

    <script>
        const tableBody = document.getElementById('tableBody');
        const loadError = document.getElementById('loadError');
        let currentProduct = null; // 当前选中的商品
        let currentQuantity = 1; // 加购数量（默认1）
        // 核心：读取同文件夹的products.json文件
        fetch('products.json') // 路径确保与shop.html同级
           .then(response => {
                // 检查文件是否存在（404错误）
                if (!response.ok) {
                    throw new Error(`文件不存在或无法访问，状态码：${response.status}`);
                }
                return response.json(); // 解析JSON数据
            })
           .then(products => {
                // 检查JSON是否为数组格式
                if (!Array.isArray(products)) {
                    throw new Error('products.json格式错误，需为数组类型（如：[{"商品名":"xxx","价格":xx},...]）');
                }
                // 动态生成商品表格行
                products.forEach(product => {
                    // 跳过缺少关键字段的商品（避免报错）
                    if (!product.商品名 || product.价格 === undefined) {
                        console.warn('跳过无效商品（缺少商品名或价格）：', product);
                        return;
                    }
                    const row = document.createElement('tr');
                    // 时间列（当前时间）
                    const timeCell = document.createElement('td');
                    timeCell.textContent = new Date().toLocaleString(); // 格式：2025/11/5 16:48:00
                    // 商品名列
                    const nameCell = document.createElement('td');
                    nameCell.textContent = product.商品名;
                    // 价格列
                    const priceCell = document.createElement('td');
                    priceCell.textContent = `¥${Number(product.价格).toFixed(2)}`; // 统一价格格式（保留2位小数）
                    // 操作列（加购按钮）
                    const actionCell = document.createElement('td');
                    const addBtn = document.createElement('button');
                    addBtn.textContent = '加购';
                    addBtn.style.padding = '5px 10px';
                    addBtn.style.backgroundColor = '#8b4513';
                    addBtn.style.color = 'white';
                    addBtn.style.border = 'none';
                    addBtn.style.borderRadius = '3px';
                    addBtn.style.cursor = 'pointer';
                    // 点击加购按钮打开弹窗
                    addBtn.onclick = () => {
                        currentProduct = product;
                        document.getElementById('popupProductInfo').textContent = 
                            `${product.商品名} ¥${Number(product.价格).toFixed(2)}`;
                        currentQuantity = 1; // 重置数量为1
                        document.getElementById('quantity').value = currentQuantity;
                        document.getElementById('myPopup').style.display = 'block';
                    };
                    actionCell.appendChild(addBtn);
                    // 组装表格行
                    row.appendChild(timeCell);
                    row.appendChild(nameCell);
                    row.appendChild(priceCell);
                    row.appendChild(actionCell);
                    tableBody.appendChild(row);
                });
            })
           .catch(error => {
                // 显示加载失败提示
                loadError.style.display = 'block';
                console.error('商品数据加载失败：', error);
            });
        // 1. 搜索功能（根据商品名过滤）
        function filterTable() {
            const input = document.querySelector('.search-input');
            const filter = input.value.trim().toUpperCase(); // 转为大写，忽略大小写
            const rows = tableBody.getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const nameCell = rows[i].getElementsByTagName('td')[1]; // 商品名在第2列（index=1）
                if (nameCell) {
                    const productName = nameCell.textContent.toUpperCase();
                    // 匹配则显示，不匹配则隐藏
                    rows[i].style.display = productName.includes(filter)? '' : 'none';
                }
            }
        }
        // 2. 回车触发搜索
        function handleKeyDown(event) {
            if (event.key === 'Enter') {
                filterTable();
                event.preventDefault(); // 阻止表单提交（若有）
            }
        }
        // 3. 弹窗数量增减
        function incrementQuantity() {
            currentQuantity++;
            document.getElementById('quantity').value = currentQuantity;
        }
        function decrementQuantity() {
            if (currentQuantity > 1) { // 数量不低于1
                currentQuantity--;
                document.getElementById('quantity').value = currentQuantity;
            }
        }
        // 4. 关闭弹窗
        function closePopup() {
            document.getElementById('myPopup').style.display = 'none';
        }
        // 5. 加入购物车（存入localStorage）
        function addToCart() {
            if (!currentProduct) return; // 防止无商品时点击
            
            // 读取现有购物车数据（无则为空数组）
            const cart = JSON.parse(localStorage.getItem('cart')) || [];
            // 检查商品是否已在购物车（避免重复添加，只增加数量）
            const existingItemIndex = cart.findIndex(item => item.name === currentProduct.商品名);
            
            if (existingItemIndex > -1) {
                // 已存在：数量叠加
                cart[existingItemIndex].quantity += currentQuantity;
            } else {
                // 不存在：新增商品
                cart.push({
                    name: currentProduct.商品名,
                    price: Number(currentProduct.价格), // 转为数字类型
                    quantity: currentQuantity,
                    time: new Date().toLocaleString()
                });
            }
            // 保存到localStorage
            localStorage.setItem('cart', JSON.stringify(cart));
            // 显示加购成功提示
            const toast = document.getElementById('addedToast');
            toast.style.display = 'block';
            setTimeout(() => toast.style.display = 'none', 2000); // 2秒后隐藏
            // 关闭弹窗
            closePopup();
        }
        // 6. 底部导航跳转
        function goToHome() {
            window.location.href = "index.html"; // 刷新首页
        }
        // 新增：特价/新品页面跳转
    function goToSpecial() {
        window.location.href = "shop.html";
    }
        function goToCart() {
            window.location.href = "cart.html"; // 跳转到购物车
        }
        // 7. 复制微信号
        function copyWechat() {
            const wechatNumber ='meiliaigou4'; // 微信号（可修改）
            navigator.clipboard.writeText(wechatNumber)
               .then(() => {
                    const toast = document.getElementById('copiedToast');
                    toast.style.display = 'block';
                    setTimeout(() => toast.style.display = 'none', 5000); // 5秒后隐藏
                })
               .catch(err => {
                    alert('复制失败，请手动复制：' + wechatNumber);
                    console.error('复制错误：', err);
                });
        }
        // 点击弹窗外部关闭弹窗（优化体验）
        window.onclick = function(event) {
            const popup = document.getElementById('myPopup');
            if (event.target === popup) {
                closePopup();
            }
        }
    </script>
</body>
</html>